<ion-header class="ion-no-border">
    <ion-toolbar>
        <ion-title>{{ settingsService.t().TAB_HISTORY }}</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="history-content">
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <ion-header collapse="condense">
        <ion-toolbar>
            <ion-title size="large">{{ settingsService.t().TAB_HISTORY }}</ion-title>
        </ion-toolbar>
    </ion-header>

    <div class="history-container">
        @if (isLoading()) {
        <div class="loading-container">
            <ion-spinner name="crescent" color="primary"></ion-spinner>
            <p>{{ settingsService.t().LOADING }}</p>
        </div>
        } @else {
        <!-- Summary Stats -->
        <ion-card class="summary-card">
            <ion-card-content>
                <div class="summary-row">
                    <div class="summary-item danger">
                        <ion-icon name="flame"></ion-icon>
                        <div class="summary-info">
                            <span class="summary-value">{{ getDangerCount() }}</span>
                            <span class="summary-label">{{ settingsService.t().Status.DANGER }}</span>
                        </div>
                    </div>
                    <div class="summary-item safe">
                        <ion-icon name="shield-checkmark"></ion-icon>
                        <div class="summary-info">
                            <span class="summary-value">{{ getSafeCount() }}</span>
                            <span class="summary-label">{{ settingsService.t().Status.SAFE }}</span>
                        </div>
                    </div>
                    <div class="summary-item total">
                        <ion-icon name="time"></ion-icon>
                        <div class="summary-info">
                            <span class="summary-value">{{ historyLogs().length }}</span>
                            <span class="summary-label">Total</span>
                        </div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>

        <!-- Filter Segment -->
        <ion-segment [value]="selectedFilter()" (ionChange)="onFilterChange($event)" mode="ios">
            <ion-segment-button value="all">
                <ion-label>{{ settingsService.t().FILTER_ALL }}</ion-label>
            </ion-segment-button>
            <ion-segment-button value="danger">
                <ion-label>{{ settingsService.t().FILTER_DANGER }}</ion-label>
            </ion-segment-button>
            <ion-segment-button value="safe">
                <ion-label>{{ settingsService.t().FILTER_SAFE }}</ion-label>
            </ion-segment-button>
        </ion-segment>

        <!-- Logs List -->
        @if (filteredLogs.length === 0) {
        <div class="empty-state">
            <ion-icon name="document-text-outline"></ion-icon>
            <p>{{ settingsService.t().NO_DATA }}</p>
        </div>
        } @else {
        <ion-list lines="none" class="history-list">
            @for (item of filteredLogs; track item.id) {
            <ion-item class="history-item" [class]="item.type" (click)="openDetail(item)" detail="false">
                <div class="status-indicator" slot="start" [class]="item.type">
                    <ion-icon [name]="getIcon(item.type)"></ion-icon>
                </div>
                <ion-label>
                    <div class="item-header">
                        <!-- Dynamic Title -->
                        <h3>
                            {{ item.status_label === 'BAHAYA' ? settingsService.t().Status.DANGER_DETECTED :
                            settingsService.t().Status.SYSTEM_SECURE }}
                        </h3>
                        <span class="item-time">{{ getTimeAgo(item.waktu) }}</span>
                    </div>
                    <!-- Dynamic Message -->
                    <p class="item-message">
                        {{ item.status_label === 'BAHAYA' ? settingsService.t().Status.TEMP_HIGH_PREFIX :
                        settingsService.t().Status.TEMP_NORMAL_PREFIX }} {{ item.lokasi }}
                    </p>
                    <div class="item-meta">
                        <ion-badge [color]="item.type === 'danger' ? 'danger' : 'success'" class="status-badge">
                            {{ settingsService.getStatusLabel(item.status_label) }}
                        </ion-badge>
                        <span class="meta-separator">â€¢</span>
                        <span class="meta-val">
                            <ion-icon name="thermometer"></ion-icon> {{ settingsService.getTemp(item.suhu) }}{{
                            settingsService.getTempUnitLabel() }}
                        </span>
                    </div>
                </ion-label>
                <ion-icon name="chevron-forward" slot="end" class="chevron"></ion-icon>
            </ion-item>
            }
        </ion-list>
        }
        }
    </div>
</ion-content>